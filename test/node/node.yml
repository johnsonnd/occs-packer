---

- hosts: all
  gather_facts: true
  become: true

  vars:
    nodejs_install_dir: /usr/nlm
    nodejs_version: "6.11.1"

    appadmin_include_node: true
    appadmin_node_path: /usr/nlm/node/bin

    # Tests the splunk forwarder which we don't typically include
    splunk_forwarder_indexer: splunk1.occs-cloud.local
    splunk_forwarder_index: web-access
    splunk_forwarder_logs:
      - path: /var/log/httpd/access_log
      - path: /var/log/httpd/error_log
        index: web-errors
      - path: /var/log/messages
        index: messages
      - path: /var/log/secure
        index: secure

    awslogs_region: us-east-1
    awslogs_logs:
     - file: /var/log/httpd/access_log
       format: "%d/%b/%Y:%H:%M:%S %z"
       time_zone: "UTC"
       initial_position: "end_of_file"
       group_name: 'httpd-access-log'
       stream_name: '{instance_id}-access'

     - file: /var/log/httpd/error_log
       format: "%d %b %y %H:%M:%S.%f"
       time_zone: "UTC"
       initial_position: "end_of_file"
       group_name: 'httpd-access-log'
       stream_name: '{instance_id}-error'

     - file: /var/log/messages
       format: "%b %d %H:%M:%S"
       time_zone: "LOCAL"
       initial_position: "start_of_file"
       group_name: 'var-log-messages'
       stream_name: '{instance_id}'

     - file: /var/log/secure
       format: "%b %d %H:%M:%S"
       time_zone: "LOCAL"
       initial_position: "start_of_file"
       group_name: 'var-log-secure'
       stream_name: '{instance_id}'


  roles:
    # Test roles for ruby AMI
    - occsab-appadmin
    - occsab-httpd
    - occsab-node
    - occs-awslogs
    - occs-splunk-forwarder
